
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>openmdao.utils.file_wrap &#8212; OpenMDAO 2.8.0 Beta documentation</title>
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/OpenMDAO_Favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OpenMDAO 2.8.0 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/OpenMDAO_Logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_guide/index.html">Basic User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced_guide/index.html">Advanced User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features/index.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_manual/index.html">Theory Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../other/om_command.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/citing.html">How to Cite OpenMDAO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/repo_guide/index.html">Building a Tool on Top of OpenMDAO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/api_translation.html">Upgrading from OpenMDAO 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other/file_wrap.html">File Wrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../_srcdocs/index.html">Source Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_docs/index.html">Developer Docs (if youâ€™re going to contribute code)</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Search OpenMDAO</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="checkbox" name="search_source" /> Include Source Docs
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for openmdao.utils.file_wrap</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A collection of utilities for file wrapping.</span>

<span class="sd">Note: This is a work in progress.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="k">import</span> <span class="n">CaselessLiteral</span><span class="p">,</span> <span class="n">Combine</span><span class="p">,</span> <span class="n">OneOrMore</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> \
    <span class="n">TokenConverter</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span> <span class="n">oneOf</span><span class="p">,</span> <span class="n">printables</span><span class="p">,</span> <span class="n">ParserElement</span><span class="p">,</span> <span class="n">alphanums</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">_getformat</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the output format for a floating point number.</span>

<span class="sd">    The general format is used with 16 places of accuracy, except for when</span>
<span class="sd">    the floating point value is an integer, in which case a decimal point</span>
<span class="sd">    followed by a single zero is used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val : float or int</span>
<span class="sd">        the number which needs formatted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    string</span>
<span class="sd">        the format string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.16g</span><span class="s2">&quot;</span>


<span class="k">class</span> <span class="nc">_SubHelper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces file text at the correct word location in a line.</span>

<span class="sd">    This class contains the Helper Function that is passed to re.sub.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _newtext : string</span>
<span class="sd">        text to insert.</span>
<span class="sd">    _replace_location : int</span>
<span class="sd">        location in the file where replacement is to occur.</span>
<span class="sd">    _current_location : int</span>
<span class="sd">        current location in the file.</span>
<span class="sd">    _counter : int</span>
<span class="sd">        counter</span>
<span class="sd">    _start_location : int</span>
<span class="sd">        initial location where replacement is to occur.</span>
<span class="sd">    _end_location : int</span>
<span class="sd">        final location where replacement is to occur.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_location</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_location</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_location</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newtext</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new word location and value for replacement.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newtext : string</span>
<span class="sd">            text to insert.</span>
<span class="sd">        location : int</span>
<span class="sd">            location in the file where replacement is to occur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span> <span class="o">=</span> <span class="n">newtext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replace_location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newtext</span><span class="p">,</span> <span class="n">start_location</span><span class="p">,</span> <span class="n">end_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a new starting location, ending location, and value for replacement.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newtext : string</span>
<span class="sd">            text to insert.</span>
<span class="sd">        start_location : int</span>
<span class="sd">            location</span>
<span class="sd">        end_location : int</span>
<span class="sd">            location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span> <span class="o">=</span> <span class="n">newtext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_location</span> <span class="o">=</span> <span class="n">start_location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_location</span> <span class="o">=</span> <span class="n">end_location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace text in file.</span>

<span class="sd">        This function should be passed to re.sub.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : string</span>
<span class="sd">            text to insert.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            newtext if current location is replace location else the input text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_location</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_getformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">replace_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace array of text values in file.</span>

<span class="sd">        This function should be passed to re.sub.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : string</span>
<span class="sd">            text to insert.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            newtext if current location is replace location else the input text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_location</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_location</span> <span class="ow">and</span> \
           <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter</span><span class="p">]</span>
                <span class="n">newval</span> <span class="o">=</span> <span class="n">_getformat</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">%</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_newtext</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">newval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>


<div class="viewcode-block" id="ToInteger"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToInteger">[docs]</a><span class="k">class</span> <span class="nc">ToInteger</span><span class="p">(</span><span class="n">TokenConverter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converter for PyParsing that is used to turn a token into an int.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToInteger.postParse"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToInteger.postParse">[docs]</a>    <span class="k">def</span> <span class="nf">postParse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instring</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert token into an integer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instring : string</span>
<span class="sd">            the input string</span>
<span class="sd">        loc : int</span>
<span class="sd">            the location of the matching string</span>
<span class="sd">        tokenlist : list</span>
<span class="sd">            list of matched tokens</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            integer value for token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokenlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="ToFloat"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToFloat">[docs]</a><span class="k">class</span> <span class="nc">ToFloat</span><span class="p">(</span><span class="n">TokenConverter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converter for PyParsing that is used to turn a token into a float.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToFloat.postParse"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToFloat.postParse">[docs]</a>    <span class="k">def</span> <span class="nf">postParse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instring</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert token into a float.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instring : string</span>
<span class="sd">            the input string</span>
<span class="sd">        loc : int</span>
<span class="sd">            the location of the matching string</span>
<span class="sd">        tokenlist : list</span>
<span class="sd">            list of matched tokens</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            float value for token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">tokenlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="ToNan"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToNan">[docs]</a><span class="k">class</span> <span class="nc">ToNan</span><span class="p">(</span><span class="n">TokenConverter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converter for PyParsing that is used to turn a token into Python nan.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToNan.postParse"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToNan.postParse">[docs]</a>    <span class="k">def</span> <span class="nf">postParse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instring</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert token into Python nan.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instring : string</span>
<span class="sd">            the input string</span>
<span class="sd">        loc : int</span>
<span class="sd">            the location of the matching string</span>
<span class="sd">        tokenlist : list</span>
<span class="sd">            list of matched tokens</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            the float value for NaN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ToInf"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToInf">[docs]</a><span class="k">class</span> <span class="nc">ToInf</span><span class="p">(</span><span class="n">TokenConverter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converter for PyParsing that is used to turn a token into Python inf.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToInf.postParse"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.ToInf.postParse">[docs]</a>    <span class="k">def</span> <span class="nf">postParse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instring</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">tokenlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert token into Python inf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        instring : string</span>
<span class="sd">            the input string</span>
<span class="sd">        loc : int</span>
<span class="sd">            the location of the matching string</span>
<span class="sd">        tokenlist : list</span>
<span class="sd">            list of matched tokens</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            the float value for infinity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="InputFileGenerator"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator">[docs]</a><span class="k">class</span> <span class="nc">InputFileGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility to generate an input file from a template.</span>

<span class="sd">    Substitution of values is supported. Data is located with a simple API.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _template_filename : string or None</span>
<span class="sd">        the name of the template file.</span>
<span class="sd">    _output_filename : string or None</span>
<span class="sd">        the name of the output file.</span>
<span class="sd">    _delimiter : int</span>
<span class="sd">        delimiter.</span>
<span class="sd">    _reg : int</span>
<span class="sd">        regular expression.</span>
<span class="sd">    _data : list of string</span>
<span class="sd">        the contents of the file, by line</span>
<span class="sd">    _current_row : int</span>
<span class="sd">        the current row of the file</span>
<span class="sd">    _anchored : bool</span>
<span class="sd">        indicator that position is relative to a landmark location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InputFileGenerator.__init__"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_filename</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[^ </span><span class="se">\n</span><span class="s1">]+&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="InputFileGenerator.set_template_file"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.set_template_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the name of the template file to be used.</span>

<span class="sd">        The template file is also read into memory when this method is called.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Name of the template file to be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">templatefile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">templatefile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">templatefile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="InputFileGenerator.set_generated_file"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.set_generated_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_generated_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the name of the file that will be generated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Name of the input file to be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_filename</span> <span class="o">=</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="InputFileGenerator.set_delimiters"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.set_delimiters">[docs]</a>    <span class="k">def</span> <span class="nf">set_delimiters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the delimiters that are used to identify field boundaries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        delimiter : str</span>
<span class="sd">            A string containing characters to be used as delimiters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[^&#39;</span> <span class="o">+</span> <span class="n">delimiter</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">]+&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InputFileGenerator.mark_anchor"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.mark_anchor">[docs]</a>    <span class="k">def</span> <span class="nf">mark_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor</span><span class="p">,</span> <span class="n">occurrence</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark the location of a landmark.</span>

<span class="sd">        This lets you describe data by relative position. Note that a forward</span>
<span class="sd">        search begins at the old anchor location. If you want to restart the</span>
<span class="sd">        search for the anchor at the file beginning, then call ``reset_anchor()``</span>
<span class="sd">        before ``mark_anchor``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        anchor : string</span>
<span class="sd">            The text you want to search for.</span>

<span class="sd">        occurrence : integer, optional</span>
<span class="sd">            Find nth instance of text; default is 1 (first). Use -1 to</span>
<span class="sd">            find last occurrence. Reverse searches always start at the end</span>
<span class="sd">            of the file no matter the state of any previous anchor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">occurrence</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The value for occurrence must be an integer&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">occurrence</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span><span class="p">,</span> <span class="n">max_lines</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># If we are marking a new anchor from an existing anchor, and</span>
                <span class="c1"># the anchor is mid-line, then we still search the line, but</span>
                <span class="c1"># only after the anchor.</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">anchor</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

                    <span class="n">instance</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+=</span> <span class="n">count</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">occurrence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">max_lines</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># If we are marking a new anchor from an existing anchor, and</span>
                <span class="c1"># the anchor is mid-line, then we still search the line, but</span>
                <span class="c1"># only before the anchor.</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">max_lines</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">anchor</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">instance</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>

                <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;0 is not valid for an anchor occurrence.&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find pattern </span><span class="si">%s</span><span class="s2"> in template file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">anchor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_filename</span><span class="p">))</span></div>

<div class="viewcode-block" id="InputFileGenerator.reset_anchor"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.reset_anchor">[docs]</a>    <span class="k">def</span> <span class="nf">reset_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset anchor to the beginning of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="InputFileGenerator.transfer_var"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.transfer_var">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change a single variable in the template relative to the current anchor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float, integer, bool, string</span>
<span class="sd">            New value to set at the location.</span>

<span class="sd">        row : integer</span>
<span class="sd">            Number of lines offset from anchor line (0 is anchor line).</span>
<span class="sd">            This can be negative.</span>

<span class="sd">        field : integer</span>
<span class="sd">            Which word in line to replace, as denoted by delimiter(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="n">_SubHelper</span><span class="p">()</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="n">newline</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">replace</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">newline</span></div>

<div class="viewcode-block" id="InputFileGenerator.transfer_array"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.transfer_array">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">row_start</span><span class="p">,</span> <span class="n">field_start</span><span class="p">,</span> <span class="n">field_end</span><span class="p">,</span>
                       <span class="n">row_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the values of an array in the template relative to the current anchor.</span>

<span class="sd">        This should generally be used for one-dimensional or free form arrays.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float, integer, bool, str</span>
<span class="sd">            Array of values to insert.</span>
<span class="sd">        row_start : integer</span>
<span class="sd">            Starting row for inserting the array. This is relative</span>
<span class="sd">            to the anchor, and can be negative.</span>
<span class="sd">        field_start : integer</span>
<span class="sd">            Starting field in the given row_start as denoted by</span>
<span class="sd">            delimiter(s).</span>
<span class="sd">        field_end : integer</span>
<span class="sd">            The final field the array uses in row_end.</span>
<span class="sd">            We need this to figure out if the template is too small or large</span>
<span class="sd">        row_end : integer, optional</span>
<span class="sd">            Use if the array wraps to cover additional lines.</span>
<span class="sd">        sep : integer, optional</span>
<span class="sd">            Separator to use if we go beyond the template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Simplified input for single-line arrays</span>
        <span class="k">if</span> <span class="n">row_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">row_end</span> <span class="o">=</span> <span class="n">row_start</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="n">_SubHelper</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row_start</span><span class="p">,</span> <span class="n">row_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">row_end</span><span class="p">:</span>
                <span class="n">f_end</span> <span class="o">=</span> <span class="n">field_end</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_end</span> <span class="o">=</span> <span class="mi">99999</span>

            <span class="n">sub</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_start</span><span class="p">,</span> <span class="n">f_end</span><span class="p">)</span>
            <span class="n">field_start</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">newline</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">replace_array</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">newline</span>

        <span class="c1"># Sometimes an array is too large for the example in the template</span>
        <span class="c1"># This is resolved by adding more fields at the end</span>
        <span class="k">if</span> <span class="n">sub</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="n">sub</span><span class="o">.</span><span class="n">_counter</span><span class="p">:]:</span>
                <span class="n">newline</span> <span class="o">=</span> <span class="n">newline</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">newline</span>

        <span class="c1"># Sometimes an array is too small for the template</span>
        <span class="c1"># This is resolved by removing fields</span>
        <span class="k">elif</span> <span class="n">sub</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># TODO - Figure out how to handle this.</span>
            <span class="c1"># Ideally, we&#39;d remove the extra field placeholders</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Array is too small for the template.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="InputFileGenerator.transfer_2Darray"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.transfer_2Darray">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_2Darray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">row_start</span><span class="p">,</span> <span class="n">row_end</span><span class="p">,</span> <span class="n">field_start</span><span class="p">,</span> <span class="n">field_end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the values of a 2D array in the template relative to the current anchor.</span>

<span class="sd">        This method is specialized for 2D arrays, where each row of the array is</span>
<span class="sd">        on its own line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : ndarray</span>
<span class="sd">            Array of values to insert.</span>
<span class="sd">        row_start : integer</span>
<span class="sd">            Starting row for inserting the array. This is relative</span>
<span class="sd">            to the anchor, and can be negative.</span>
<span class="sd">        row_end : integer</span>
<span class="sd">            Final row for the array, relative to the anchor.</span>
<span class="sd">        field_start : integer</span>
<span class="sd">            starting field in the given row_start as denoted by</span>
<span class="sd">            delimiter(s).</span>
<span class="sd">        field_end : integer</span>
<span class="sd">            The final field the array uses in row_end.</span>
<span class="sd">            We need this to figure out if the template is too small or large.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">_SubHelper</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row_start</span><span class="p">,</span> <span class="n">row_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">sub</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">field_start</span><span class="p">,</span> <span class="n">field_end</span><span class="p">)</span>

            <span class="n">newline</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reg</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">replace_array</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">newline</span>

            <span class="n">sub</span><span class="o">.</span><span class="n">_current_location</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sub</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div>

        <span class="c1"># TODO - Note, we currently can&#39;t handle going beyond the end of</span>
        <span class="c1">#        the template line</span>

<div class="viewcode-block" id="InputFileGenerator.clearline"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.clearline">[docs]</a>    <span class="k">def</span> <span class="nf">clearline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the contents of a row with the newline character.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row : integer</span>
<span class="sd">            Row number to clear, relative to current anchor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span></div>

<div class="viewcode-block" id="InputFileGenerator.generate"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.InputFileGenerator.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the template file to generate the input file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        return_data : bool</span>
<span class="sd">            if True, generated file data will be returned as a string</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            the generated file data if return_data is True or output filename</span>
<span class="sd">            has not been provided, else None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_data</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">return_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="FileParser"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser">[docs]</a><span class="k">class</span> <span class="nc">FileParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility to locate and read data from a file.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    _filename : string</span>
<span class="sd">        the name of the file.</span>
<span class="sd">    _data : list of string</span>
<span class="sd">        the contents of the file, by line</span>
<span class="sd">    _delimiter : string</span>
<span class="sd">        the name of the file.</span>
<span class="sd">    _end_of_line_comment_char : string</span>
<span class="sd">        end-of-line comment character to be ignored.</span>
<span class="sd">    _full_line_comment_char : string</span>
<span class="sd">        comment character that signifies a line should be skipped.</span>
<span class="sd">    _current_row : int</span>
<span class="sd">        the current row of the file.</span>
<span class="sd">    _anchored : bool</span>
<span class="sd">        indicator that position is relative to a landmark location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FileParser.__init__"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end_of_line_comment_char</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full_line_comment_char</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        end_of_line_comment_char : string, optional</span>
<span class="sd">            end-of-line comment character to be ignored.</span>
<span class="sd">            (e.g., Python supports in-line comments with &quot;#&quot;.)</span>

<span class="sd">        full_line_comment_char : string, optional</span>
<span class="sd">            comment character that signifies a line should be skipped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_of_line_comment_char</span> <span class="o">=</span> <span class="n">end_of_line_comment_char</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_line_comment_char</span> <span class="o">=</span> <span class="n">full_line_comment_char</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_delimiters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileParser.set_file"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.set_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the name of the file that will be generated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Name of the input file to be generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">inputfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_of_line_comment_char</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_line_comment_char</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">inputfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_line_comment_char</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_of_line_comment_char</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">inputfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileParser.set_delimiters"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.set_delimiters">[docs]</a>    <span class="k">def</span> <span class="nf">set_delimiters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the delimiters that are used to identify field boundaries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        delimiter : string</span>
<span class="sd">            A string containing characters to be used as delimiters. The</span>
<span class="sd">            default value is &#39; \t&#39;, which means that spaces and tabs are not</span>
<span class="sd">            taken as data but instead mark the boundaries. Note that the</span>
<span class="sd">            parser is smart enough to recognize characters within quotes as</span>
<span class="sd">            non-delimiters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>

        <span class="k">if</span> <span class="n">delimiter</span> <span class="o">!=</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span>
            <span class="n">ParserElement</span><span class="o">.</span><span class="n">setDefaultWhitespaceChars</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delimiter</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_tokens</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileParser.mark_anchor"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.mark_anchor">[docs]</a>    <span class="k">def</span> <span class="nf">mark_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor</span><span class="p">,</span> <span class="n">occurrence</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark the location of a landmark, which lets you describe data by relative position.</span>

<span class="sd">        Note that a forward search begins at the old anchor location. If you want to restart</span>
<span class="sd">        the search for the anchor at the file beginning, then call ``reset_anchor()`` before</span>
<span class="sd">        ``mark_anchor``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        anchor : str</span>
<span class="sd">            The text you want to search for.</span>
<span class="sd">        occurrence : integer</span>
<span class="sd">            Find nth instance of text; default is 1 (first). Use -1 to</span>
<span class="sd">            find last occurrence. Reverse searches always start at the end</span>
<span class="sd">            of the file no matter the state of any previous anchor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">occurrence</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The value for occurrence must be an integer&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">occurrence</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span><span class="p">,</span> <span class="n">max_lines</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># If we are marking a new anchor from an existing anchor, and</span>
                <span class="c1"># the anchor is mid-line, then we still search the line, but</span>
                <span class="c1"># only after the anchor.</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">anchor</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">anchor</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>

                    <span class="n">instance</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+=</span> <span class="n">count</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>

                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">occurrence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">max_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">max_lines</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="c1"># If we are marking a new anchor from an existing anchor, and</span>
                <span class="c1"># the anchor is mid-line, then we still search the line, but</span>
                <span class="c1"># only before the anchor.</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="n">max_lines</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">anchor</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">anchor</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">instance</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>

                <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;0 is not valid for an anchor occurrence.&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not find pattern </span><span class="si">%s</span><span class="s2"> in output file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="n">anchor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">))</span></div>

<div class="viewcode-block" id="FileParser.reset_anchor"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.reset_anchor">[docs]</a>    <span class="k">def</span> <span class="nf">reset_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset anchor to the beginning of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anchored</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FileParser.transfer_line"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.transfer_line">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an entire line, relative to current anchor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row : integer</span>
<span class="sd">            Number of lines offset from anchor line (0 is anchor line).</span>
<span class="sd">            This can be negative.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            line at the location requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileParser.transfer_var"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.transfer_var">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">fieldend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single variable relative to the current anchor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row : integer</span>
<span class="sd">            Number of lines offset from anchor line (0 is anchor line).</span>
<span class="sd">            This can be negative.</span>
<span class="sd">        field : integer</span>
<span class="sd">            If the delimiter is a set of chars: which word in line to retrieve.</span>
<span class="sd">            If the delimiter is &#39;columns&#39;: character position to start.</span>
<span class="sd">        fieldend : integer (optional)</span>
<span class="sd">            If the delimiter is a set of chars: IGNORED.</span>
<span class="sd">            If the delimiter is &#39;columns&#39;: position of last character to return, or if</span>
<span class="sd">            omitted, the end of the line is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            data from the requested location in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span>

        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">==</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fieldend</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[(</span><span class="n">field</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[(</span><span class="n">field</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">fieldend</span><span class="p">)]</span>

            <span class="c1"># Let pyparsing figure out if this is a number, and return it</span>
            <span class="c1"># as a float or int as appropriate</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="c1"># data might have been split if it contains whitespace. If so,</span>
            <span class="c1"># just return the whole string</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">field</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="FileParser.transfer_keyvar"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.transfer_keyvar">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_keyvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">occurrence</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rowoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for a key relative to the current anchor and get a field from that line.</span>

<span class="sd">        You can do the same thing with a call to ``mark_anchor`` and ``transfer_var``.</span>
<span class="sd">        This function just combines them for convenience.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : string</span>
<span class="sd">            the key to search for.</span>
<span class="sd">        field : integer</span>
<span class="sd">            Which field to transfer. Field 0 is the key.</span>
<span class="sd">        occurrence : integer</span>
<span class="sd">            Find nth instance of text; default is 1 (first value</span>
<span class="sd">            field). Use -1 to find last occurance. Position 0 is the key</span>
<span class="sd">            field, so it should not be used as a value for occurrence.</span>
<span class="sd">        rowoffset : integer (optional)</span>
<span class="sd">            Optional row offset from the occurrence of key. This can</span>
<span class="sd">            also be negative.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            data from the requested location in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">occurrence</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">occurrence</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The value for occurrence must be a nonzero integer&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">occurrence</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">instance</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">occurrence</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">instance</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">occurrence</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="n">row</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">row</span> <span class="o">+</span> <span class="n">rowoffset</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;KeyField&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span></div>

<div class="viewcode-block" id="FileParser.transfer_array"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.transfer_array">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowstart</span><span class="p">,</span> <span class="n">fieldstart</span><span class="p">,</span> <span class="n">rowend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fieldend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an array of variables relative to the current anchor.</span>

<span class="sd">        Setting the delimiter to &#39;columns&#39; elicits some special behavior</span>
<span class="sd">        from this method. Normally, the extraction process wraps around</span>
<span class="sd">        at the end of a line and continues grabbing each field at the start of</span>
<span class="sd">        a newline. When the delimiter is set to columns, the parameters</span>
<span class="sd">        (rowstart, fieldstart, rowend, fieldend) demark a box, and all</span>
<span class="sd">        values in that box are retrieved. Note that standard whitespace</span>
<span class="sd">        is the secondary delimiter in this case.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rowstart : integer</span>
<span class="sd">            Row number to start, relative to the current anchor.</span>
<span class="sd">        fieldstart : integer</span>
<span class="sd">            Field number to start.</span>
<span class="sd">        rowend : integer, optional</span>
<span class="sd">            Row number to end. If not set, then only one row is grabbed.</span>
<span class="sd">        fieldend : integer</span>
<span class="sd">            Field number to end.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            data from the requested location in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">rowstart</span>

        <span class="k">if</span> <span class="n">rowend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="n">j1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">rowend</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fieldend</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fieldend is missing, currently required&quot;</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">==</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">]</span>

                <span class="c1"># Stripping whitespace may be controversial.</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="c1"># Let pyparsing figure out if this is a number, and return it</span>
                <span class="c1"># as a float or int as appropriate</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[:])</span>
                <span class="c1"># data might have been split if it contains whitespace. If the</span>
                <span class="c1"># data is string, we probably didn&#39;t want this.</span>
                <span class="k">if</span> <span class="n">newdata</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
                    <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j2</span> <span class="o">-</span> <span class="n">j1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]))</span>

                <span class="n">fieldstart</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="FileParser.transfer_2Darray"><a class="viewcode-back" href="../../../_srcdocs/packages/utils/file_wrap.html#openmdao.utils.file_wrap.FileParser.transfer_2Darray">[docs]</a>    <span class="k">def</span> <span class="nf">transfer_2Darray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowstart</span><span class="p">,</span> <span class="n">fieldstart</span><span class="p">,</span> <span class="n">rowend</span><span class="p">,</span> <span class="n">fieldend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a 2D array of variables relative to the current anchor.</span>

<span class="sd">        Each line of data is placed in a separate row.</span>

<span class="sd">        If the delimiter is set to &#39;columns&#39;, then the values contained in</span>
<span class="sd">        fieldstart and fieldend should be the column number instead of the</span>
<span class="sd">        field number.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rowstart : integer</span>
<span class="sd">            Row number to start, relative to the current anchor.</span>
<span class="sd">        fieldstart : integer</span>
<span class="sd">            Field number to start.</span>
<span class="sd">        rowend : integer</span>
<span class="sd">            Row number to end relative to current anchor.</span>
<span class="sd">        fieldend : integer (optional)</span>
<span class="sd">            Field number to end. If not specified, grabs all fields up to the</span>
<span class="sd">            end of the line.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>
<span class="sd">            data from the requested location in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fieldend</span> <span class="ow">and</span> <span class="p">(</span><span class="n">fieldstart</span> <span class="o">&gt;</span> <span class="n">fieldend</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;fieldend must be greater than fieldstart&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rowstart</span> <span class="o">&gt;</span> <span class="n">rowend</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;rowend must be greater than rowstart&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">j1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">rowstart</span>
        <span class="n">j2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_row</span> <span class="o">+</span> <span class="n">rowend</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span> <span class="o">==</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fieldend</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>

            <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[:])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j2</span> <span class="o">-</span> <span class="n">j1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">row</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
                <span class="k">if</span> <span class="n">fieldend</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):]</span>

                <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fieldend</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):])</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j2</span> <span class="o">-</span> <span class="n">j1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)))</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">row</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
                <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_line</span><span class="p">()</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">fieldend</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><span class="n">fieldend</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parsed</span><span class="p">[(</span><span class="n">fieldstart</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):])</span>

        <span class="k">return</span> <span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">_parse_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a single data line that may contain string or numerical data.</span>

<span class="sd">        Float and Int &#39;words&#39; are converted to their appropriate type.</span>
<span class="sd">        Exponentiation is supported, as are NaN and Inf.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &lt;ParserElement&gt;</span>
<span class="sd">            the parsed line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_parse_token</span>

    <span class="k">def</span> <span class="nf">_reset_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up the tokens for pyparsing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Somewhat of a hack, but we can only use printables if the delimiter is</span>
        <span class="c1"># just whitespace. Otherwise, some seprators (like &#39;,&#39; or &#39;=&#39;) potentially</span>
        <span class="c1"># get parsed into the general string text. So, if we have non whitespace</span>
        <span class="c1"># delimiters, we need to fall back to just alphanums, and then add in any</span>
        <span class="c1"># missing but important symbols to parse.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="n">textchars</span> <span class="o">=</span> <span class="n">printables</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textchars</span> <span class="o">=</span> <span class="n">alphanums</span>

            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delimiter</span><span class="p">:</span>
                    <span class="n">textchars</span> <span class="o">=</span> <span class="n">textchars</span> <span class="o">+</span> <span class="n">symbol</span>

        <span class="n">digits</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">oneOf</span><span class="p">(</span><span class="s2">&quot;+ -&quot;</span><span class="p">)</span>
        <span class="n">ee</span> <span class="o">=</span> <span class="n">CaselessLiteral</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">CaselessLiteral</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

        <span class="n">num_int</span> <span class="o">=</span> <span class="n">ToInteger</span><span class="p">(</span><span class="n">Combine</span><span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">+</span> <span class="n">digits</span><span class="p">))</span>

        <span class="n">num_float</span> <span class="o">=</span> <span class="n">ToFloat</span><span class="p">(</span><span class="n">Combine</span><span class="p">(</span>
            <span class="n">Optional</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">((</span><span class="n">digits</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">digits</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">dot</span> <span class="o">+</span> <span class="n">digits</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">Optional</span><span class="p">(</span><span class="n">ee</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">+</span> <span class="n">digits</span><span class="p">)</span>
        <span class="p">))</span>

        <span class="c1"># special case for a float written like &quot;3e5&quot;</span>
        <span class="n">mixed_exp</span> <span class="o">=</span> <span class="n">ToFloat</span><span class="p">(</span><span class="n">Combine</span><span class="p">(</span><span class="n">digits</span> <span class="o">+</span> <span class="n">ee</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span> <span class="o">+</span> <span class="n">digits</span><span class="p">))</span>

        <span class="n">nan</span> <span class="o">=</span> <span class="p">(</span><span class="n">ToInf</span><span class="p">(</span><span class="n">oneOf</span><span class="p">(</span><span class="s2">&quot;Inf -Inf&quot;</span><span class="p">))</span> <span class="o">|</span>
               <span class="n">ToNan</span><span class="p">(</span><span class="n">oneOf</span><span class="p">(</span><span class="s2">&quot;NaN nan NaN%  NaNQ NaNS qNaN sNaN 1.#SNAN 1.#QNAN -1.#IND&quot;</span><span class="p">)))</span>

        <span class="n">string_text</span> <span class="o">=</span> <span class="n">Word</span><span class="p">(</span><span class="n">textchars</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line_parse_token</span> <span class="o">=</span> <span class="p">(</span><span class="n">OneOrMore</span><span class="p">((</span><span class="n">nan</span> <span class="o">|</span> <span class="n">num_float</span> <span class="o">|</span> <span class="n">mixed_exp</span> <span class="o">|</span> <span class="n">num_int</span> <span class="o">|</span> <span class="n">string_text</span><span class="p">)))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OpenMDAO 2.8.0 Beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, openmdao.org.
      Last updated on Aug 08, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>